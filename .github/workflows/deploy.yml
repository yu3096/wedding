name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      # 저장소 Actions 변수 주입
      VITE_BASE: ${{ vars.VITE_BASE }}
      VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
      VITE_SUPABASE_PUBLISHABLE_KEY: ${{ secrets.VITE_SUPABASE_PUBLISHABLE_KEY }}

      # --- 신랑/신부 본인 이름 ---
      VITE_GROOM_NAME: ${{ secrets.VITE_GROOM_NAME }}
      VITE_BRIDE_NAME: ${{ secrets.VITE_BRIDE_NAME }}

      # --- 웨딩홀
      VITE_WEDDING_DATE: ${{ vars.VITE_WEDDING_DATE }}
      VITE_WEDDING_TIME: ${{ vars.VITE_WEDDING_TIME }}
      VITE_WEDDING_HOLE: ${{ vars.VITE_WEDDING_HOLE }}
      VITE_WEDDING_ADDR: ${{ vars.VITE_WEDDING_ADDR }}

      VITE_WEDDING_SUBWAY: ${{ vars.VITE_WEDDING_SUBWAY }}
      VITE_WEDDING_BUS: ${{ vars.VITE_WEDDING_BUS }}
      VITE_WEDDING_CAR: ${{ vars.VITE_WEDDING_CAR }}

      # --- 부모님 성함 ---
      VITE_GROOM_FATHER: ${{ secrets.VITE_GROOM_FATHER }}
      VITE_GROOM_MOTHER: ${{ secrets.VITE_GROOM_MOTHER }}
      VITE_BRIDE_FATHER: ${{ secrets.VITE_BRIDE_FATHER }}
      VITE_BRIDE_MOTHER: ${{ secrets.VITE_BRIDE_MOTHER }}

      VITE_GROOM_ACCOUNTS: ${{ secrets.VITE_GROOM_ACCOUNTS }}
      VITE_BRIDE_ACCOUNTS: ${{ secrets.VITE_BRIDE_ACCOUNTS }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
      - run: npm ci || npm install --no-audit --no-fund
      - run: npm run build
      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4